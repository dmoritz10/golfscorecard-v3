<!DOCTYPE html5>
<html>
<head>
  
<link rel="manifest" href="manifest.json">

<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, minimum-scale=1">

<link rel="icon" href="https://dmoritz10.github.io/golfscorecard-v3/images/icons/golf-icon-144.png">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.17.0/jquery.validate.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-touchspin/4.2.5/jquery.bootstrap-touchspin.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-touchspin/4.2.5/jquery.bootstrap-touchspin.min.js"></script>

<script src="https://cdn.rawgit.com/FezVrasta/snackbarjs/1.1.0/dist/snackbar.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.0/chart.min.js" integrity="sha512-asxKqQghC1oBShyhiBwA+YgotaSYKxGP1rcSYTDrB0U6DxwlJjU59B67U8+5/++uFjcuVM8Hh5cokLjZlhm3Vg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<style>

.btn-blue {
  color: #fff;
  background-color: #007bff;
  border-color: #007bff;
}

.btn-blue:hover {
  color: #fff;
  background-color: #0069d9;
  border-color: #0062cc;
}

.btn-blue:focus, .btn-primary.focus {
  box-shadow: 0 0 0 0.2rem rgba(38, 143, 255, 0.5);
}

.btn-blue.disabled, .btn-blue:disabled {
  color: #fff;
  background-color: #007bff;
  border-color: #007bff;
}

.btn-blue:not(:disabled):not(.disabled):active, .btn-blue:not(:disabled):not(.disabled).active,
.show > .btn-blue.dropdown-toggle {
  color: #fff;
  background-color: #0062cc;
  border-color: #005cbf;
}

.btn-blue:not(:disabled):not(.disabled):active:focus, .btn-blue:not(:disabled):not(.disabled).active:focus,
.show > .btn-blue.dropdown-toggle:focus {
  box-shadow: 0 0 0 0.2rem rgba(38, 143, 255, 0.5);
}

.popover-body {
    max-height: 550px;
    overflow-y: auto;
    white-space:pre-wrap;
}    
    
.popover {
  max-width: 350px;
  width: 300px;
}


/* .modal-open .modal {
    display: flex !important;
    align-items: center;
    justify-content: center;
} */

.modal-body { 
  /* max-width: 90vw; */
  overflow-y: auto;
  overflow-x: auto; 
}

.material-icons.md-18 { font-size: 18px; }
.material-icons.md-24 { font-size: 24px; }
.material-icons.md-36 { font-size: 36px; }
.material-icons.md-48 { font-size: 48px; }

.dropdown-toggle:after { display:none }

.more-vert-menu {

  margin-left:-250px;
  margin-right:-30px;width:250px;
  background:white;
  border-radius: 10px;

}

.dropdown-menu.dropdown-menu-left, .dropdown-menu[x-placement=bottom-start] {
   
  transform-origin: 100% 0;
  
}


fade {
    position: absolute;
    bottom: 0px;

    display: block;
  
    width: 100%;
    height: 50px;
  
    background-image: linear-gradient(to bottom, 
        rgba(255, 255, 255, 0), 
        rgba(255, 255, 255, 0.9)
    100%);
}

.watermark {
    position: absolute;
    opacity: 0.15;
    font-size: 3em;
    width: 100%;
    text-align: right;
    z-index: 1000;
}

#main-panel {  
  background-color: #f9f9f9; 
  height: 100% !important;
  margin:0px;
  padding-top: 0px;
  padding-left: 0px;  
  padding-right: 0px;  
  padding-bottom: 5px;

}

.toast {
  position: absolute;
  width: 50%;
  bottom: 30px;
  z-index: 9999;
  
}

body {
    height:100vh;
    overflow-y: scroll;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none;  /* Internet Explorer 10+ */
}

body::-webkit-scrollbar { /* WebKit */
    width: 0px;
    height: 0px;
    background: transparent; /* Chrome/Safari/Webkit */
} 

.disable-scrollbars::-webkit-scrollbar {
    width: 0px;
    height: 0px;
    background: transparent; /* Chrome/Safari/Webkit */
    
}

.disable-scrollbars {
  height:100vh;
  overflow-y: scroll;
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none;  /* Internet Explorer 10+ */
  
}

.popover-body {
  color: blue;
}

.cursor-pointer {
  cursor:pointer;
}

.golfer-icon {
  background: url('images/icons/golfer-icon bg trns.png');
  background-color: transparent;
  height: 24px;
  width: 24px;
  display: inline-block;
  /* Other styles here */
}
.swingu-icon {
  background: url('images/icons/swingu-icon.png');
  background-color: transparent;
  height: 24px;
  width: 24px;
  display: inline-block;
  /* Other styles here */
}

</style>

</head>

<body>

<script>

  if ("serviceWorker" in navigator) {
    if (navigator.serviceWorker.controller) {
      console.log("[PWA Builder] active service worker found, no need to register");
    } else {
      // Register the service worker
      navigator.serviceWorker
        .register("pwabuilder-sw.js", {
          scope: "./"
        })
        .then(function (reg) {
          console.log("[PWA Builder] Service worker has been registered for scope: " + reg.scope);
        })
        .catch(function (err) {
          console.log("[PWA Builder] Service worker registration failed: ", err)
        });
    }
  }
  
// var fp = document.featurePolicy
// console.log(fp)

  try { canUseGeo = document.featurePolicy.allowsFeature("geolocation") }
  catch(err) {console.log(err)}
  try { canUseGeo = document.featurePolicy.allowedFeatures("geolocation") }
  catch(err) {console.log(err)}
  try { canUseGeo = document.permissionsPolicy.allowsFeature("geolocation") }
  catch(err) {console.log(err)}
    
  $(async function () {

    console.log('start code load')

    // get loads of html files started
    
    var loadList = $(".load-html")

    for (i = 0; i < loadList.length; i++) {
      
      var src = loadList[i].dataset.source
      $(loadList[i]).load(encodeURI(src))
      console.log(src)
    
    }

    // get array of script files to be loaded.  Exclude index-js.js because it must run after all other scripts are fully loaded

    var loadList = $(".load-script")
    var script_arr = []
    for (i = 0; i < loadList.length; i++) {

      var src = loadList[i].dataset.source
      if (src !== 'index-js.js') {

        script_arr.push(src)
        console.log(src)
      
      }
    }

    // define a function to load array of scripts and wait for all to load before continuing

    $.getMultiScripts = function(arr, path) {
      var _arr = $.map(arr, function(scr) {
        return $.getScript( (path||"") + scr );
      });
        
      _arr.push($.Deferred(function( deferred ){
        $( deferred.resolve );
      }));
        
      return $.when.apply($, _arr);
    }

    await $.getMultiScripts(script_arr).done(function() {
      console.log('load index-js.js')
      $.getScript( 'index-js.js' )      // load and run index-js.js last
      console.log('all scripts loaded')
    });



  console.log('end code load')

  });
    
</script> 
    
    
  
  <div id="main-panel" class="m-0 p-0 container-fluid">
  
    <div class="container" style="display: flex;justify-content: center;align-items: center ">
      <div class="toast d-none modal-body" id="myToast">
        <div class="toast-body">
            <h5 id="toast-content" class="d-flex justify-content-center text-center "></h5>
        </div>
      </div>
    </div>
  
    <ul data-role="navbar" class="nav nav-pills nav-fill" role="tablist" hidden >
      <li class="nav-item">
        <a class="nav-link p-2"        data-toggle="tab" href="#Auth"      role="tab">Authorize</a>
      </li>
      <li class="nav-item">
        <a class="nav-link p-2"        data-toggle="tab" href="#Home"      role="tab">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link p-2"        data-toggle="tab" href="#PlayRound" role="tab">Play Round</a>
      </li>
      <li class="nav-item">
        <a class="nav-link p-2"        data-toggle="tab" href="#Scorecard" role="tab">Play Round</a>
      </li>
      <li class="nav-item">
        <a class="nav-link p-2"        data-toggle="tab" href="#RoundStats" role="tab">Round Stats</a>
      </li>
      <li class="nav-item">
        <a class="nav-link p-2"        data-toggle="tab" href="#ShowRounds" role="tab">Show Rounds</a>
      </li>
      <li class="nav-item">
        <a class="nav-link p-2"        data-toggle="tab" href="#ShowHCP" role="tab">Round Detail</a>
      </li>
      <li class="nav-item">
        <a class="nav-link p-2"        data-toggle="tab" href="#Clubs" role="tab">Clubs</a>
      </li>
      <li class="nav-item">
        <a class="nav-link p-2"        data-toggle="tab" href="#Stats" role="tab">Stats</a>
      </li>
      <li class="nav-item bg-white">
        <a class="nav-link p-2"        data-toggle="tab" href="#Teetimes" role="tab">Tee Times</a>
      </li>
      <li class="nav-item bg-white">
        <a class="nav-link p-2"        data-toggle="tab" href="#Courses" role="tab">Courses</a>
      </li>
      <li class="nav-item bg-white">
        <a class="nav-link p-2"        data-toggle="tab" href="#Golfers" role="tab">Golfers</a>
      </li>
    </ul>
    
    <div class="tab-content">
  
      <div class="m-0 p-0 tab-pane fade show active disable-scrollbars" id="Auth" role="tabpanel">

        <div class="load-html" data-source="auth"></div>
        <div class="load-script d-none" data-source="auth-js.js"></div>
               
      </div> 

      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="Home" role="tabpanel">

        <div class="load-html" data-source="home"></div>
        <div class="load-script d-none" data-source="home-js.js"></div>
               
      </div> 

      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="PlayRound" role="tabpanel">

        <div class="load-html" data-source="play round"></div>
        <div class="load-script d-none" data-source="play round-js.js"></div>
                        
     </div> 

      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="Scorecard" role="tabpanel">

        <div class="load-html" data-source="scorecard"></div>
        <div class="load-script d-none" data-source="scorecard-js.js"></div>
                        
      </div>        
      
      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="RoundStats" role="tabpanel">

        <div class="load-html" data-source="round stats"></div>
        <div class="load-script d-none" data-source="round stats-js.js"></div>
                              
      </div>        
      
        
      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="ShowRounds" role="tabpanel">

        <div class="load-html" data-source="show rounds"></div>
        <div class="load-script d-none" data-source="show rounds-js.js"></div>
                        
     
      </div>        
      
      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="ShowHCP"  role="tabpanel">

        <div class="load-html" data-source="show hcp"></div>
        <div class="load-script d-none" data-source="show hcp-js.js"></div>
                        
     
      </div>        
      
      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="Clubs" role="tabpanel">

        <div class="load-html" data-source="clubs"></div>
        <div class="load-script d-none" data-source="clubs-js.js"></div>
                        
      
      </div>        
      
      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="Stats" role="tabpanel">

        <div class="load-html" data-source="stats"></div>
        <div class="load-script d-none" data-source="stats-js.js"></div>
                       
      </div>        
      
      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="Teetimes" role="tabpanel">

        <div class="load-html" data-source="teetimes"></div>
        <div class="load-script d-none" data-source="teetimes-js.js"></div>
                        
     </div>        
      
      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="Courses" role="tabpanel">

        <div class="load-html" data-source="courses"></div>
        <div class="load-script d-none" data-source="courses-js.js"></div>
                        

      </div>        
      
      <div class="m-0 p-0 tab-pane fade disable-scrollbars" id="Golfers" role="tabpanel">

        <div class="load-html" data-source="golfers"></div>
        <div class="load-script d-none" data-source="golfers-js.js"></div>
                

      </div>        
    </div>  
  </div> 

<div class="load-script d-none" data-source="table-builder.js"></div>
<div class="load-script d-none" data-source="get rounds-js.js"></div>
<div class="load-script d-none" data-source="update summary info.js"></div>
<div class="load-script d-none" data-source="xhr.js"></div>
<div class="load-script d-none" data-source="index-js.js"></div>
  
  <!-- <button id="test_button" class="d-none">Test</button> -->
  
<script>

var currUser = {}

var API_KEY = 'AIzaSyBG5YxMTiBdvxD5-xxVp0LA1M8IXz8Xtbo';  // TODO: Update placeholder with desired API key.

var CLIENT_ID = '764306262696-esbdj8daoee741d44fdhrh5fehjtjjm5.apps.googleusercontent.com';  // TODO: Update placeholder with desired client ID.

var SCOPES = "https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.metadata.readonly";

var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4", 
                      "https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest",
                      "https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
  
      var testButton = document.getElementById('test_button');

      /**
       *  On load, called to load the auth2 library and API client library.
       */
      function handleClientLoad() {
console.log('handleload')
console.log(this)

        gapi.load('client:auth2', initClient);
      }
     

      /**
       *  Initializes the API client library and sets up sign-in state
       *  listeners.
       */
      async function initClient() {
      
        await gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          discoveryDocs: DISCOVERY_DOCS,
          fetch_basic_profile: true,
          scope: SCOPES
        }).then(function () {
          // Listen for sign-in state changes.
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          // Handle the initial sign-in state.
          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());

          //          testButton.onclick = handleTestClick;
        }, function(error) {
          console.log(JSON.stringify(error, null, 2));
        });
        
      }

      /**
       *  Called when the signed in status changes, to update the UI
       *  appropriately. After a sign-in, the API is called.
       */
       async function  updateSigninStatus(isSignedIn) {

        if (isSignedIn) { 

          console.log('signed in')

          var currUserObj = await gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile();

          currUser['email']     = currUserObj.getEmail()
          currUser['firstName'] = currUserObj.getGivenName()
          currUser['lastName']  = currUserObj.getFamilyName()
          currUser['fullName']  = currUserObj.getName()
          currUser['emailName'] = currUser['email'].split('@')[0]

          if (currUser.firstName) {
            $('#authSigninStatus').html('Hi ' + currUser.firstName + '.<br>You are signed in.')
          } else {
            $('#authSigninStatus').html('Hi ' + currUser.emailName + '.<br>You are signed in.')
          }

          var rtn = await getSSId()

          if (rtn.fileId) {spreadsheetId = rtn.fileId}
          else {$('#authSigninStatus').html(rtn.msg);return}
           
          await initialUI();

          goHome()

        } else {

          console.log('NOT signed in')

          $('#authSigninStatus').html('You are signed out.  Authorization is required.')

          currUser = {}
     
          gotoTab('Auth')
        }
      }

      /**
       *  Sign in the user upon button click.
       */
      function handleAuthClick(event) {
        
        gapi.auth2.getAuthInstance().signIn();
      }

      /**
       *  Sign out the user upon button click.
       */
      function handleSignoutClick(event) {
        
        gapi.auth2.getAuthInstance().signOut();
      }

      async function getSSId() {

        console.log(currUser)


        var q = "name = 'Dan Golf - " + currUser.emailName +
                "' AND " + "mimeType='application/vnd.google-apps.spreadsheet'" + 
                " AND " + "trashed = false"

        console.log(q)          

        var ssId = await gapi.client.drive.files.list({
            q: q,
            fields: 'nextPageToken, files(id, name, ownedByMe)',
            spaces: 'drive'
        }).then(function(response) {

          var files = response.result.files;

          // files = files.filter(item => item.ownedByMe);    // remove files that are shared with me

          if (!files || files.length == 0)  return {fileId:null,msg:"'Dan Golf' not found"}

          if (files.length > 1)             return {fileId:null,msg:"'Dan Golf' not unique"}

          return {fileId:files[0].id,msg:'ok'}

        });  

        return ssId

}

</script>

<script 

    async defer src="https://apis.google.com/js/platform.js"
    onload="this.onload=function(){};handleClientLoad()"
    
    >
console.log('hi dan')
    console.log(this)

</script>

</body>
</html>


